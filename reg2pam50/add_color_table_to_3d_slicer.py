# Organ color details
organ_colors = [
    # {"organ": "background", "index": 0, "color": [0, 0, 0]},
    {"organ": "spleen", "index": 1, "color": [157, 108, 162]},
    {"organ": "kidney_right", "index": 2, "color": [185, 102, 83]},
    {"organ": "kidney_left", "index": 3, "color": [185, 102, 83]},
    {"organ": "gallbladder", "index": 4, "color": [139, 150, 98]},
    {"organ": "liver", "index": 5, "color": [221, 130, 101]},
    {"organ": "stomach", "index": 6, "color": [216, 132, 105]},
    {"organ": "aorta", "index": 7, "color": [224, 97, 76]},
    {"organ": "inferior_vena_cava", "index": 8, "color": [0, 151, 206]},
    {"organ": "portal_vein_and_splenic_vein", "index": 9, "color": [0, 151, 206]},
    {"organ": "pancreas", "index": 10, "color": [249, 180, 111]},
    {"organ": "adrenal_gland_right", "index": 11, "color": [249, 186, 150]},
    {"organ": "adrenal_gland_left", "index": 12, "color": [249, 186, 150]},
    {"organ": "lung_upper_lobe_left", "index": 13, "color": [172, 138, 115]},
    {"organ": "lung_lower_lobe_left", "index": 14, "color": [224, 186, 162]},
    {"organ": "lung_upper_lobe_right", "index": 15, "color": [172, 138, 115]},
    {"organ": "lung_middle_lobe_right", "index": 16, "color": [202, 164, 140]},
    {"organ": "lung_lower_lobe_right", "index": 17, "color": [224, 186, 162]},
    {"organ": "vertebrae_L5", "index": 18, "color": [212, 188, 102]},
    {"organ": "vertebrae_L4", "index": 19, "color": [212, 188, 102]},
    {"organ": "vertebrae_L3", "index": 20, "color": [212, 188, 102]},
    {"organ": "vertebrae_L2", "index": 21, "color": [212, 188, 102]},
    {"organ": "vertebrae_L1", "index": 22, "color": [212, 188, 102]},
    {"organ": "vertebrae_T12", "index": 23, "color": [226, 202, 134]},
    {"organ": "vertebrae_T11", "index": 24, "color": [226, 202, 134]},
    {"organ": "vertebrae_T10", "index": 25, "color": [226, 202, 134]},
    {"organ": "vertebrae_T9", "index": 26, "color": [226, 202, 134]},
    {"organ": "vertebrae_T8", "index": 27, "color": [226, 202, 134]},
    {"organ": "vertebrae_T7", "index": 28, "color": [226, 202, 134]},
    {"organ": "vertebrae_T6", "index": 29, "color": [226, 202, 134]},
    {"organ": "vertebrae_T5", "index": 30, "color": [226, 202, 134]},
    {"organ": "vertebrae_T4", "index": 31, "color": [226, 202, 134]},
    {"organ": "vertebrae_T3", "index": 32, "color": [226, 202, 134]},
    {"organ": "vertebrae_T2", "index": 33, "color": [226, 202, 134]},
    {"organ": "vertebrae_T1", "index": 34, "color": [226, 202, 134]},
    {"organ": "vertebrae_C7", "index": 35, "color": [255, 255, 255]},
    {"organ": "vertebrae_C6", "index": 36, "color": [255, 255, 255]},
    {"organ": "vertebrae_C5", "index": 37, "color": [255, 255, 255]},
    {"organ": "vertebrae_C4", "index": 38, "color": [255, 255, 255]},
    {"organ": "vertebrae_C3", "index": 39, "color": [255, 255, 255]},
    {"organ": "vertebrae_C2", "index": 40, "color": [255, 255, 255]},
    {"organ": "vertebrae_C1", "index": 41, "color": [255, 255, 255]},
    {"organ": "esophagus", "index": 42, "color": [211, 171, 143]},
    {"organ": "trachea", "index": 43, "color": [182, 228, 255]},
    {"organ": "heart_myocardium", "index": 44, "color": [206, 110, 84]},
    {"organ": "heart_atrium_left", "index": 45, "color": [203, 108, 81]},
    {"organ": "heart_ventricle_left", "index": 46, "color": [152, 55, 13]},
    {"organ": "heart_atrium_right", "index": 47, "color": [210, 115, 89]},
    {"organ": "heart_ventricle_right", "index": 48, "color": [181, 85, 57]},
    {"organ": "pulmonary_artery", "index": 49, "color": [0, 122, 171]},
    {"organ": "brain", "index": 50, "color": [250, 250, 225]},
    {"organ": "iliac_artery_left", "index": 51, "color": [216, 101, 79]},
    {"organ": "iliac_artery_right", "index": 52, "color": [216, 101, 79]},
    {"organ": "iliac_vena_left", "index": 53, "color": [0, 151, 206]},
    {"organ": "iliac_vena_right", "index": 54, "color": [0, 151, 206]},
    {"organ": "small_bowel", "index": 55, "color": [205, 167, 142]},
    {"organ": "duodenum", "index": 56, "color": [255, 253, 229]},
    {"organ": "colon", "index": 57, "color": [204, 168, 143]},
    {"organ": "rib_left_1", "index": 58, "color": [253, 232, 158]},
    {"organ": "rib_left_2", "index": 59, "color": [253, 232, 158]},
    {"organ": "rib_left_3", "index": 60, "color": [253, 232, 158]},
    {"organ": "rib_left_4", "index": 61, "color": [253, 232, 158]},
    {"organ": "rib_left_5", "index": 62, "color": [253, 232, 158]},
    {"organ": "rib_left_6", "index": 63, "color": [253, 232, 158]},
    {"organ": "rib_left_7", "index": 64, "color": [253, 232, 158]},
    {"organ": "rib_left_8", "index": 65, "color": [253, 232, 158]},
    {"organ": "rib_left_9", "index": 66, "color": [253, 232, 158]},
    {"organ": "rib_left_10", "index": 67, "color": [253, 232, 158]},
    {"organ": "rib_left_11", "index": 68, "color": [253, 232, 158]},
    {"organ": "rib_left_12", "index": 69, "color": [253, 232, 158]},
    {"organ": "rib_right_1", "index": 70, "color": [253, 232, 158]},
    {"organ": "rib_right_2", "index": 71, "color": [253, 232, 158]},
    {"organ": "rib_right_3", "index": 72, "color": [253, 232, 158]},
    {"organ": "rib_right_4", "index": 73, "color": [253, 232, 158]},
    {"organ": "rib_right_5", "index": 74, "color": [253, 232, 158]},
    {"organ": "rib_right_6", "index": 75, "color": [253, 232, 158]},
    {"organ": "rib_right_7", "index": 76, "color": [253, 232, 158]},
    {"organ": "rib_right_8", "index": 77, "color": [253, 232, 158]},
    {"organ": "rib_right_9", "index": 78, "color": [253, 232, 158]},
    {"organ": "rib_right_10", "index": 79, "color": [253, 232, 158]},
    {"organ": "rib_right_11", "index": 80, "color": [253, 232, 158]},
    {"organ": "rib_right_12", "index": 81, "color": [253, 232, 158]},
    {"organ": "humerus_left", "index": 82, "color": [205, 179, 108]},
    {"organ": "humerus_right", "index": 83, "color": [205, 179, 108]},
    {"organ": "scapula_left", "index": 84, "color": [205, 179, 108]},
    {"organ": "scapula_right", "index": 85, "color": [205, 179, 108]},
    {"organ": "clavicula_left", "index": 86, "color": [205, 179, 108]},
    {"organ": "clavicula_right", "index": 87, "color": [205, 179, 108]},
    {"organ": "femur_left", "index": 88, "color": [255, 238, 170]},
    {"organ": "femur_right", "index": 89, "color": [255, 238, 170]},
    {"organ": "hip_left", "index": 90, "color": [212, 188, 102]},
    {"organ": "hip_right", "index": 91, "color": [212, 188, 102]},
    {"organ": "sacrum", "index": 92, "color": [212, 188, 102]},
    {"organ": "face", "index": 93, "color": [127, 127, 127]},
    {"organ": "gluteus_maximus_left", "index": 94, "color": [188, 95, 76]},
    {"organ": "gluteus_maximus_right", "index": 95, "color": [188, 95, 76]},
    {"organ": "gluteus_medius_left", "index": 96, "color": [178, 105, 76]},
    {"organ": "gluteus_medius_right", "index": 97, "color": [178, 105, 76]},
    {"organ": "gluteus_minimus_left", "index": 98, "color": [178, 95, 86]},
    {"organ": "gluteus_minimus_right", "index": 99, "color": [178, 95, 86]},
    {"organ": "autochthon_left", "index": 100, "color": [171, 85, 68]},
    {"organ": "autochthon_right", "index": 101, "color": [171, 85, 68]},
    {"organ": "iliopsoas_left", "index": 102, "color": [188, 95, 76]},
    {"organ": "iliopsoas_right", "index": 103, "color": [188, 95, 76]},
    {"organ": "urinary_bladder", "index": 104, "color": [222, 154, 132]},
    {"organ": "cord", "index": 200, "color": [244, 214, 49]},
    {"organ": "csf", "index": 201, "color": [85, 188, 255]},
    {"organ": "disc_L5_S", "index": 202, "color": [218, 255, 255]},
    {"organ": "disc_L4_L5", "index": 203, "color": [218, 255, 255]},
    {"organ": "disc_L3_L4", "index": 204, "color": [218, 255, 255]},
    {"organ": "disc_L2_L3", "index": 205, "color": [218, 255, 255]},
    {"organ": "disc_L1_L2", "index": 206, "color": [218, 255, 255]},
    {"organ": "disc_T12_L1", "index": 207, "color": [218, 255, 255]},
    {"organ": "disc_T11_T12", "index": 208, "color": [218, 255, 255]},
    {"organ": "disc_T10_T11", "index": 209, "color": [218, 255, 255]},
    {"organ": "disc_T9_T10", "index": 210, "color": [218, 255, 255]},
    {"organ": "disc_T8_T9", "index": 211, "color": [218, 255, 255]},
    {"organ": "disc_T7_T8", "index": 212, "color": [218, 255, 255]},
    {"organ": "disc_T6_T7", "index": 213, "color": [218, 255, 255]},
    {"organ": "disc_T5_T6", "index": 214, "color": [218, 255, 255]},
    {"organ": "disc_T4_T5", "index": 215, "color": [218, 255, 255]},
    {"organ": "disc_T3_T4", "index": 216, "color": [218, 255, 255]},
    {"organ": "disc_T2_T3", "index": 217, "color": [218, 255, 255]},
    {"organ": "disc_T1_T2", "index": 218, "color": [218, 255, 255]},
    {"organ": "disc_C7_T1", "index": 219, "color": [218, 255, 255]},
    {"organ": "disc_C6_C7", "index": 220, "color": [218, 255, 255]},
    {"organ": "disc_C5_C6", "index": 221, "color": [218, 255, 255]},
    {"organ": "disc_C4_C5", "index": 222, "color": [218, 255, 255]},
    {"organ": "disc_C3_C4", "index": 223, "color": [218, 255, 255]},
    {"organ": "disc_C2_C3", "index": 224, "color": [218, 255, 255]}
]

name = "TotalSegMRI"

# Create color table node
try:
    color_table_node = slicer.util.getNode(name)
except slicer.util.MRMLNodeNotFoundException:
    # Create a color table node
    color_table_node = slicer.mrmlScene.AddNewNodeByClass("vtkMRMLColorTableNode", name)
    color_table_node.SetTypeToUser()
    color_table_node.HideFromEditorsOff()
    color_table_node.SetNumberOfColors(organ_colors[-1]["index"] + 1)
    color_table_node.NamesInitialisedOn()

# Set color for each organ
for organ_color in organ_colors:
    organ = organ_color["organ"]
    index = organ_color["index"]
    color = organ_color["color"]
    color_table_node.SetColor(index, organ, color[0]/255.0, color[1]/255.0, color[2]/255.0, 1.0)


# Get the currently active segmentation
segmentation_node = slicer.mrmlScene.GetNodeByID('vtkMRMLSegmentationNode1')

# Get the currently active volume
volume_node = slicer.mrmlScene.GetNodeByID('vtkMRMLScalarVolumeNode1')

# Save the label map to the file
segmentation_folder = r"C:\Users\yw\Google Drive\Study\Sheba\TotalSegmentatorMRI_SynthSeg"
slicer.vtkSlicerSegmentationsModuleLogic.ExportSegmentsBinaryLabelmapRepresentationToFiles(segmentation_folder, segmentation_node, None, "nii.gz", True, volume_node,  slicer.vtkSegmentation.EXTENT_REFERENCE_GEOMETRY, color_table_node)
